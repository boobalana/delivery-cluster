delivery_fqdn "<%= node['delivery-cluster']['delivery']['fqdn'] %>"

delivery['chef_username']    = "delivery"
delivery['chef_private_key'] = "/etc/delivery/delivery.pem"
delivery['chef_server']      = "<%= node['delivery-cluster']['delivery']['chef_server'] %>"

delivery['default_search']   = "<%= @default_search %>"

<% node['delivery-cluster']['delivery']['ldap'].each do |attr, value| -%>
delivery['<%= attr %>'] = <%= value.pretty_inspect -%>
<% end -%>

insights['enable'] = <%= node['delivery-cluster']['delivery']['insights']['enable'] %>

<%= node['delivery-cluster']['delivery']['config'] if node['delivery-cluster']['delivery']['config'] -%>

<% if node['delivery-cluster']['delivery']['dr']['enable'] -%>
<% if node['delivery-cluster']['delivery']['primary'] -%>
# Primary DR Config
delivery['primary'] = true
postgresql['trust_auth_cidr_addresses'] = [ '127.0.0.1/32', '::1/128', '<%= node['delivery-cluster']['delivery']['ip'] %>/32', '<%= node['delivery-cluster']['delivery']['dr']['ip'] %>/32' ]
postgresql['listen_address'] = 'localhost,<%= node['delivery-cluster']['delivery']['ip'] %>'
delivery['standby_ip'] = '<%= node['delivery-cluster']['delivery']['dr']['ip'] %>'
<% elsif node['delivery-cluster']['delivery']['standby'] -%>
# Standby DR Config
delivery['primary'] = false
delivery['primary_ip'] = '<%= node['delivery-cluster']['delivery']['ip'] %>'
postgresql['listen_address'] = 'localhost,<%= node['delivery-cluster']['delivery']['dr']['ip'] %>'
<% end -%>
<% end -%>
